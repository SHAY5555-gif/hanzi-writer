<!DOCTYPE html>
<html lang="en-us">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Hanzi Writer – Character Test</title>
    <link rel="stylesheet" href="styles.css" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
      /* Character test specific styles */
      .test-container {
        max-width: 800px;
        margin: 0 auto;
      }
      
      .char-input-large {
        width: 120px;
        height: 80px;
        font-size: 3rem;
        text-align: center;
        border: 3px solid var(--gray-200);
        border-radius: var(--radius-xl);
        background: rgba(255, 255, 255, 0.9);
        transition: var(--transition-fast);
        font-weight: 700;
        margin: 0 auto;
        display: block;
      }
      
      .char-input-large:focus {
        border-color: var(--primary);
        box-shadow: 0 0 0 4px rgba(99, 102, 241, 0.1);
        transform: scale(1.05);
        background: white;
      }
      
      .quick-chars {
        display: flex;
        flex-wrap: wrap;
        gap: 0.75rem;
        justify-content: center;
        margin-top: 1.5rem;
      }
      
      .quick-char {
        width: 50px;
        height: 50px;
        font-size: 1.5rem;
        background: white;
        border: 2px solid var(--gray-200);
        border-radius: var(--radius-md);
        cursor: pointer;
        transition: var(--transition-base);
        display: flex;
        align-items: center;
        justify-content: center;
        font-weight: 500;
      }
      
      .quick-char:hover {
        transform: scale(1.15);
        border-color: var(--primary-light);
        box-shadow: var(--shadow-md);
        background: var(--gray-50);
      }
      
      .stroke-info {
        background: rgba(255, 255, 255, 0.8);
        backdrop-filter: blur(5px);
        border-radius: var(--radius-lg);
        padding: 1.5rem;
        margin-top: 2rem;
        text-align: center;
        box-shadow: var(--shadow-md);
      }
      
      .stroke-count {
        font-size: 2rem;
        font-weight: 700;
        color: var(--primary);
      }
      
      /* Glowing effect for the writer container */
      .writer-container.practicing {
        animation: glow-pulse 2s ease-in-out infinite;
      }
      
      @keyframes glow-pulse {
        0%, 100% { box-shadow: var(--shadow-xl); }
        50% { box-shadow: var(--shadow-xl), 0 0 30px rgba(99, 102, 241, 0.3); }
      }
      
      /* Fireworks animation for success */
      .firework {
        position: fixed;
        width: 5px;
        height: 5px;
        border-radius: 50%;
        box-shadow: 0 0 6px 0 rgba(255, 223, 0, 0.8);
        animation: firework 1s ease-out forwards;
      }
      
      @keyframes firework {
        0% {
          transform: translate(0, 0);
          opacity: 1;
        }
        100% {
          opacity: 0;
        }
      }
    </style>
    <!-- Polyfills for IE11 / old browsers -->
    <script src="https://cdn.polyfill.io/v2/polyfill.min.js"></script>
    <!-- Pull Hanzi Writer from jsdelivr CDN -->
    <script src="https://cdn.jsdelivr.net/npm/hanzi-writer@latest/dist/hanzi-writer.min.js"></script>
  </head>
  <body>
    <!-- Animated particles background -->
    <div class="particles" id="particles"></div>
    
    <h1 class="title">
      <i class="fas fa-vial"></i> Hanzi Writer – Character Test
    </h1>

    <div class="test-container">
      <div class="card">
        <form class="js-char-form">
          <label>
            <span><i class="fas fa-language"></i> Enter Character to Test</span>
            <input type="text" class="char-input-large js-char" value="我" maxlength="1" />
          </label>
          
          <div class="quick-chars">
            <button type="button" class="quick-char" data-char="我">我</button>
            <button type="button" class="quick-char" data-char="你">你</button>
            <button type="button" class="quick-char" data-char="好">好</button>
            <button type="button" class="quick-char" data-char="是">是</button>
            <button type="button" class="quick-char" data-char="不">不</button>
            <button type="button" class="quick-char" data-char="的">的</button>
            <button type="button" class="quick-char" data-char="人">人</button>
            <button type="button" class="quick-char" data-char="大">大</button>
            <button type="button" class="quick-char" data-char="中">中</button>
            <button type="button" class="quick-char" data-char="国">国</button>
          </div>
          
          <button type="submit" class="btn-primary" style="margin-top: 1.5rem;">
            <i class="fas fa-sync-alt btn-icon"></i>Load Character
          </button>
        </form>
      </div>

      <div class="stroke-info">
        <p>Press the buttons below to interact with the character</p>
      </div>

      <div class="controls">
        <button class="js-animate btn-secondary" data-tooltip="Show character stroke animation">
          <i class="fas fa-film btn-icon"></i>Animate
        </button>
        <button class="js-quiz btn-accent" data-tooltip="Practice writing this character">
          <i class="fas fa-pencil-alt btn-icon"></i>Practice Quiz
        </button>
        <button class="js-toggle btn-secondary" data-tooltip="Show/hide character strokes">
          <i class="fas fa-eye btn-icon"></i>Toggle Character
        </button>
        <button class="js-toggle-hint btn-secondary" data-tooltip="Show/hide character outline">
          <i class="fas fa-border-all btn-icon"></i>Toggle Outline
        </button>
      </div>

      <div class="writer-container" id="writer-container">
        <div id="target"></div>
      </div>
    </div>

    <script type="application/javascript">
      // Create floating particles
      const particlesContainer = document.getElementById('particles');
      if (!particlesContainer) {
        const newParticlesContainer = document.createElement('div');
        newParticlesContainer.className = 'particles';
        newParticlesContainer.id = 'particles';
        document.body.appendChild(newParticlesContainer);
      }
      
      for (let i = 0; i < 15; i++) {
        const particle = document.createElement('div');
        particle.className = 'particle';
        particle.style.cssText = `
          position: absolute;
          width: 10px;
          height: 10px;
          background: rgba(99, 102, 241, 0.1);
          border-radius: 50%;
          left: ${Math.random() * 100}%;
          animation: floatUp ${15 + Math.random() * 10}s infinite;
          animation-delay: ${Math.random() * 20}s;
        `;
        particlesContainer.appendChild(particle);
      }
      
      // Add floating animation if not exists
      if (!document.querySelector('style[data-particles]')) {
        const style = document.createElement('style');
        style.setAttribute('data-particles', 'true');
        style.textContent = `
          .particles {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: -1;
          }
          @keyframes floatUp {
            0% {
              transform: translateY(100vh) scale(0);
              opacity: 0;
            }
            10% {
              opacity: 1;
            }
            90% {
              opacity: 1;
            }
            100% {
              transform: translateY(-100vh) scale(1.5);
              opacity: 0;
            }
          }
        `;
        document.head.appendChild(style);
      }
      
      var writer;
      var isCharVisible = true;
      var isOutlineVisible = true;

      function printStrokePoints(data) {
        var pointStrs = data.drawnPath.points.map((point) => `{x: ${point.x}, y: ${point.y}}`);
        console.log(`[${pointStrs.join(', ')}]`);
      }
      
      function createFireworks(x, y) {
        const colors = ['#FFD700', '#FF69B4', '#00CED1', '#FF6347', '#7FFF00'];
        for (let i = 0; i < 20; i++) {
          const firework = document.createElement('div');
          firework.className = 'firework';
          firework.style.left = x + 'px';
          firework.style.top = y + 'px';
          firework.style.backgroundColor = colors[Math.floor(Math.random() * colors.length)];
          
          const angle = (Math.PI * 2 * i) / 20;
          const velocity = 50 + Math.random() * 50;
          const dx = Math.cos(angle) * velocity;
          const dy = Math.sin(angle) * velocity;
          
          firework.style.animation = 'none';
          firework.style.transition = 'all 1s ease-out';
          document.body.appendChild(firework);
          
          setTimeout(() => {
            firework.style.transform = `translate(${dx}px, ${dy}px)`;
            firework.style.opacity = '0';
          }, 10);
          
          setTimeout(() => firework.remove(), 1000);
        }
      }

      function updateCharacter() {
        document.querySelector('#target').innerHTML = '';
        document.querySelector('#writer-container').classList.remove('practicing');

        var character = document.querySelector('.js-char').value;
        if (!character) return;
        
        window.location.hash = character;
        writer = HanziWriter.create('target', character, {
          width: 300,
          height: 300,
          renderer: 'svg',
          radicalColor: '#166E16',
          strokeColor: '#555',
          strokeWidth: 4,
          onCorrectStroke: function(data) {
            printStrokePoints(data);
            // Visual feedback for correct stroke
            const rect = document.querySelector('#target').getBoundingClientRect();
            createFireworks(rect.left + rect.width/2, rect.top + rect.height/2);
          },
          onMistake: printStrokePoints,
          onComplete: function() {
            // Success animation
            const writerEl = document.getElementById('target');
            writerEl.style.animation = 'success 0.5s ease-in-out';
            setTimeout(() => {
              writerEl.style.animation = '';
            }, 500);
            
            // Show success message
            const successMsg = document.createElement('div');
            successMsg.innerHTML = '<i class="fas fa-trophy"></i> Perfect! You\'ve mastered this character!';
            successMsg.style.cssText = `
              position: fixed;
              top: 50%;
              left: 50%;
              transform: translate(-50%, -50%);
              background: var(--gradient-accent);
              color: white;
              padding: 2rem 3rem;
              border-radius: var(--radius-xl);
              box-shadow: var(--shadow-2xl);
              font-size: 1.25rem;
              font-weight: 600;
              z-index: 1000;
              animation: fadeIn 0.3s ease-in-out;
            `;
            document.body.appendChild(successMsg);
            setTimeout(() => {
              successMsg.remove();
            }, 3000);
          },
          showCharacter: true,
          showOutline: true,
        });
        isCharVisible = true;
        isOutlineVisible = true;
        window.writer = writer;
        
        // Update stroke info
        writer.target.svg.addEventListener('load', function() {
          const strokeCount = writer._character.strokes.length;
          document.querySelector('.stroke-info').innerHTML = `
            <p><span class="stroke-count">${strokeCount}</span> strokes</p>
            <p style="color: var(--gray-600); margin-top: 0.5rem;">Press buttons to interact with the character</p>
          `;
        });
      }

      window.onload = function () {
        var char = decodeURIComponent(window.location.hash.slice(1));
        if (char) {
          document.querySelector('.js-char').value = char;
        }

        updateCharacter();

        document.querySelector('.js-char-form').addEventListener('submit', function (evt) {
          evt.preventDefault();
          updateCharacter();
        });
        
        // Quick character buttons
        document.querySelectorAll('.quick-char').forEach(btn => {
          btn.addEventListener('click', function() {
            document.querySelector('.js-char').value = this.getAttribute('data-char');
            updateCharacter();
          });
        });

        document.querySelector('.js-toggle').addEventListener('click', function () {
          const icon = this.querySelector('.btn-icon');
          if (isCharVisible) {
            writer.hideCharacter();
            icon.className = 'fas fa-eye-slash btn-icon';
          } else {
            writer.showCharacter();
            icon.className = 'fas fa-eye btn-icon';
          }
          isCharVisible = !isCharVisible;
        });
        
        document.querySelector('.js-toggle-hint').addEventListener('click', function () {
          const icon = this.querySelector('.btn-icon');
          if (isOutlineVisible) {
            writer.hideOutline();
            icon.className = 'fas fa-border-none btn-icon';
          } else {
            writer.showOutline();
            icon.className = 'fas fa-border-all btn-icon';
          }
          isOutlineVisible = !isOutlineVisible;
        });
        
        document.querySelector('.js-animate').addEventListener('click', function () {
          writer.animateCharacter();
        });
        
        document.querySelector('.js-quiz').addEventListener('click', function () {
          document.querySelector('#writer-container').classList.add('practicing');
          writer.quiz({
            showOutline: true,
          });
        });
      };
    </script>
  </body>
</html> 